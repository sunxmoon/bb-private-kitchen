{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <h2 class="text-xl font-bold text-gray-800">历史与动态</h2>

    <!-- Audit Logs -->
    <section>
        <h3 class="text-sm font-bold text-gray-400 mb-3 uppercase tracking-wider">最近操作</h3>
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 divide-y divide-gray-50">
            {% for log in logs[:10] %}
            <div class="p-3 flex items-start space-x-3">
                <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 flex-shrink-0">
                    <i class="fas fa-history text-xs"></i>
                </div>
                <div>
                    <p class="text-sm text-gray-800">
                        <span class="font-bold text-orange-500">{{ log.user.name }}</span> 
                        {% if log.action == 'CREATE_DISH' or log.action == '创建菜品' %}创造了新菜品
                        {% elif log.action == 'ADD_ORDER_ITEM' or log.action == '添加点餐' %}点了一个菜
                        {% elif log.action == 'CREATE_ORDER' or log.action == '创建订单' %}开启了新点单
                        {% elif log.action == 'UPDATE_ORDER_ITEM' or log.action == '更新点餐' %}修改了点餐
                        {% elif log.action == 'DELETE_ORDER_ITEM' or log.action == '删除点餐' %}删除了点餐
                        {% elif log.action == 'UPDATE_DISH' or log.action == '更新菜品' %}更新了菜品资料
                        {% elif log.action == 'DELETE_DISH' or log.action == '删除菜品' %}下架了菜品
                        {% else %}{{ log.action }}{% endif %}
                    </p>
                    <p class="text-[10px] text-gray-400 mt-0.5">{{ log.timestamp.strftime('%m-%d %H:%M') }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Past Orders -->
    <section>
        <h3 class="text-sm font-bold text-gray-400 mb-3 uppercase tracking-wider">历史点单</h3>
        <div class="space-y-4">
            {% for order in orders %}
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-xs font-bold px-2 py-0.5 rounded bg-gray-100 text-gray-500">#{{ order.id }}</span>
                    <span class="text-xs text-gray-400">{{ order.created_at.strftime('%Y-%m-%d') }}</span>
                </div>
                <div class="flex flex-wrap gap-2">
                    {% for item in order.items %}
                    <span class="text-xs bg-orange-50 text-orange-600 px-3 py-1 rounded-full border border-orange-100">
                        {{ item.dish.name }} ({{ item.user.name }})
                    </span>
                    {% endfor %}
                </div>
                {% if not order.items %}
                <p class="text-xs text-gray-300 italic">空单</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}
